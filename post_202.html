<h1>네트워크 계층</h1>
<h2>NAT</h2>
<ul>
<li>IPv4 주소 부족 문제 해결함.</li>
<li>나갈 땐 괜찮지만 들어올 때(in bound) 못 찾아올 수 있다.</li>
<li>그래서 나갈 때(out bound) 라우터가 포트 번호를 변환해서 내보낸다.<br>  변환 정보를 NAT translation table 에 저장하면 정상적으로 받을 수 있다.</li>
</ul>
<h2>NAT 문제</h2>
<ul>
<li>우선 네트워크 계층 디자인 상 계층 침범이 일어남.</li>
<li>또 현실적인 문제로 특정 포트를 고정시켜서 열어놓기가 힘들어서 서비스에 어려움.</li>
</ul>
<h2>IPv4 문제</h2>
<ul>
<li>애초에 디자인에서부터 보안성을 고려하지 않았음</li>
<li>주소공간이 부족함.</li>
<li>IPv6 로 갈 지, 아예 새로운 프로토콜로 갈 지.</li>
</ul>
<h2>DHCP - Dynamic Host Configuration Protocol</h2>
<ul>
<li>동적으로 host 를 설정해주는 프로토콜<br>  설정이란 내부 IP, 서브넷 마스크, DNS 셋팅 등이다.</li>
<li>호스트가 내부 네트워크를 사용할 수 있도록 해준다.<br>  NAT 에 때문에 필요한 일이다.</li>
<li>호스트가 장소를 옮겨 새로운 라우터에 접속할 수 있도록 동적으로 설정.</li>
<li>고정 IP 를 사용하면 사실 필요가 없다.</li>
<li>일종의 서버-클라이언트 모델.<br>  새로운 호스트가 클라이언트, DHCP 관리하는 애가 서버.</li>
<li>DHCP 는 app 계층에 속한다!</li>
</ul>
<h2>DHCP 장점</h2>
<ul>
<li>고정 IP 에 비해 주소 pool 을 유연하게 관리할  수 있다.</li>
<li>금전적으로도 이득</li>
<li>IP 주소 할당, 회수 로직이 필요함.</li>
</ul>
<h2>DHCP 동작</h2>
<ul>
<li>DHCP discover<br>  최초 호스트가 로컬 네트워크에 들어오면 discover 브로드캐스트 메세지 날림.<br>  호스트는 알고 있는 정보가 아무것도 없으므로 모든 장치가 들을 수 있게 도움을 요청<br>  src 현재 할당된 IP 가 없으므로 주소는 0.0.0.0, DHCP 클라이언트를 특정 포트에 돌리고 있겠다고 한다.<br>  dst 는 255.255.255.0/24 로 서브넷 브로드캐스트 한다. 포트는 같은 67 번<br>  포트가 열린 DHCP 서버 이외에 호스트는 이 브로드캐스트를 버린다.</li>
<li>DHCP offer<br>  discover 를 받은 DHCP 서버가 브로드캐스트를 한다.<br>  여전히 새로운 호스트는 IP 가 없으므로.<br>  할당할 IP 를 함께 실어 보내 제안한다..</li>
<li>DHCP request<br>  제안한 IP 주소에 대한 확정을 하려고 한다.<br>  이때까지 여전히 IP 가 없으므로 브로드캐스트 한다.</li>
<li>DHCP ACK<br>  DHCP 서버가 최종적으로 수락.<br>  호스트는 이후부터 IP, DNS 주소, 서브넷 마스크 등을 가지게 된다.<br>  이때까지도 브로드캐스트를 해야한다.</li>
</ul>
<h2>DHCP offer 바로 수락 안 하는 이유</h2>
<ul>
<li>만약 디스커버리 받은 DHCP 서버가 여러개일 경우<br>  하나만 고르도록 로직이 추가된 것임.</li>
<li>브로드캐스팅은 offer 를 수락 안 한 상태이기 때문에 사용된다.</li>
</ul>
<h2>DHCP 서버의 실체</h2>
<ul>
<li>DHCP 서버이므로 사실상 프로세스다.</li>
<li>보통 라우터와 분리되어 있지 않고 포함되어서 프로세스가 돌아간다.</li>
<li>DNS 와 함께 라우터에서 돌아간다.</li>
<li>DHCP 완료가 된 호스트의 모든 네트워크 동작은 라우터를 거친다.<br>  DNS 역할과 라우팅까지 모두.</li>
</ul>
<h2>라우터가 하는 일</h2>
<ul>
<li>여러가지 네트워크 프로세스가 돌아가고 있다.<br>  DNS 서버<br>  DHCP 서버<br>  NAT<br>  포워딩<br>  firewall</li>
<li>라우터는 고유?<br>  NAT 는 중첩이 가능해서 라우터는 고유하지 않을 수 있다?</li>
</ul>
<h2>IP 나머지 헤더 - fragmentation field</h2>
<ul>
<li>fragmentation</li>
<li>각 링크마다 MTU (Maximum Transfer Size) 가 다르다.<br>  한 번에 처리할 수 있는 패킷의 크기.</li>
<li>한 번에 처리할 수 있는 크기보다 크면 패킷을 분리한다.<br>  그리고 도착지에서 다시 합쳐진다.</li>
<li>이에 대한 정보가 IP 헤더에 포함된다.</li>
<li>field<br>  length - 원래 길이.<br>  ID - 원래 id<br>  fragflag - 쪼개진 것인가 여부<br>  offset - 위치</li>
</ul>
<h2>IP fragmentation 에서 유실 상황</h2>
<ul>
<li>만약 쪼개진 것 중 몇 개가 유실되면 reassemble 이 안된다.</li>
<li>그러면 전송계층까지 올라가지 못한다.</li>
<li>결국 TCP 의 timeout 등의 재전송 메커니즘에 의해 재전송이 이루어진다.</li>
<li>이렇게 역할이 나눠져서 동작한다.</li>
</ul>
